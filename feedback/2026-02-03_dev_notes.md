# NAVIG 개발 일지 - 2026-02-03

## 오늘의 작업 요약

Phase 2-3 스프린트 전체 기능 통합: 편집 워크스페이스, PWA 지원, 포트폴리오, AI 자막, 실시간 협업, Google Drive 통합, 다국어 지원

---

## 1. 편집 워크스페이스 (Editing Workspace)

### 1.1 페이지

| 경로 | 설명 |
|------|------|
| `/projects/[id]/edits` | 편집 프로젝트 목록 |
| `/projects/[id]/edits/[editId]` | 편집 워크스페이스 |

### 1.2 컴포넌트

**목록/생성:**
- `EditProjectList` - 편집 프로젝트 목록 그리드
- `EditProjectCard` - 편집 프로젝트 카드
- `CreateEditModal` - 편집 프로젝트 생성 모달

**워크스페이스:**
- `EditWorkspace` - 메인 워크스페이스 컨테이너
- `VideoUploader` - 영상 업로더 (드래그앤드롭, 멀티파트)
- `VideoPreview` - 영상 미리보기 (HLS 지원)
- `Timeline` - 타임라인 UI

**패널:**
- `ToolPanel` - 도구 선택 사이드바
- `TrimPanel` - 트림/자르기
- `TextPanel` - 텍스트 오버레이
- `FilterPanel` - 필터 (밝기, 대비, 채도)
- `SpeedPanel` - 속도 조절
- `AudioPanel` - 오디오 볼륨/음소거

**툴바:**
- `PlaybackControls` - 재생 컨트롤
- `WorkspaceToolbar` - 상단 툴바 (저장/등록)

**오버레이:**
- `TextOverlayRenderer` - 텍스트 오버레이 렌더링

**모달:**
- `RegisterModal` - 영상 등록 확인 모달

### 1.3 API 엔드포인트

| 메서드 | 경로 | 설명 |
|--------|------|------|
| GET/POST | `/api/projects/[id]/edits` | 편집 프로젝트 목록/생성 |
| GET/PATCH/DELETE | `/api/projects/[id]/edits/[editId]` | 상세/수정/삭제 |
| POST | `/api/projects/[id]/edits/[editId]/upload` | 멀티파트 업로드 시작 |
| POST | `/api/projects/[id]/edits/[editId]/upload/part-url` | 추가 part URL 발급 |
| POST | `/api/projects/[id]/edits/[editId]/upload-complete` | 업로드 완료 |
| POST | `/api/projects/[id]/edits/[editId]/register` | 영상 등록 |

### 1.4 상태 관리

**파일:** `src/stores/edit-workspace-store.ts`

```typescript
interface EditWorkspaceState {
  editProjectId: string | null;
  projectId: string | null;
  videoUrl: string | null;
  videoDuration: number;
  currentTime: number;
  isPlaying: boolean;
  metadata: EditMetadata;
  selectedTool: EditTool;
  // Undo/Redo 히스토리
}
```

---

## 2. PWA 지원 (Progressive Web App)

### 2.1 파일

- `public/manifest.json` - PWA 매니페스트
- `public/offline.html` - 오프라인 페이지

### 2.2 컴포넌트

- `PWAProvider` - PWA 컨텍스트 프로바이더
- `InstallPrompt` - 설치 프롬프트
- `UpdateNotification` - 업데이트 알림
- `NotificationSettings` - 알림 설정

### 2.3 API 엔드포인트

| 메서드 | 경로 | 설명 |
|--------|------|------|
| POST | `/api/push/subscribe` | 푸시 구독 |
| POST | `/api/push/send` | 푸시 알림 발송 |
| GET/PATCH | `/api/push/settings` | 알림 설정 |
| GET | `/api/push/vapid-key` | VAPID 공개키 |

### 2.4 Hook

- `use-pwa.ts` - PWA 상태 관리
- `use-push-notifications.ts` - 푸시 알림 관리

---

## 3. 포트폴리오 (Portfolio)

### 3.1 페이지

| 경로 | 설명 |
|------|------|
| `/settings/portfolio` | 포트폴리오 편집 |
| `/p/[slug]` | 공개 포트폴리오 페이지 |

### 3.2 컴포넌트

- `PortfolioEditor` - 포트폴리오 편집기
- `PublicPortfolioView` - 공개 포트폴리오 뷰
- `WorkEditorModal` - 작품 편집 모달

### 3.3 API 엔드포인트

| 메서드 | 경로 | 설명 |
|--------|------|------|
| GET/PATCH | `/api/portfolio/me` | 내 포트폴리오 |
| GET/POST | `/api/portfolio/works` | 작품 목록/추가 |
| PATCH/DELETE | `/api/portfolio/works/[id]` | 작품 수정/삭제 |
| GET | `/api/p/[slug]` | 공개 포트폴리오 조회 |

---

## 4. AI 자막 시스템 (Subtitles)

### 4.1 컴포넌트

- `SubtitleGenerator` - AI 자막 생성
- `SubtitleEditor` - 자막 편집기
- `SubtitleOverlay` - 영상 위 자막 표시
- `SubtitleTimeline` - 자막 타임라인
- `SubtitleSegmentList` - 자막 세그먼트 목록
- `SubtitleSegmentItem` - 개별 세그먼트
- `SubtitleQualityCheck` - 자막 품질 검사

### 4.2 API 엔드포인트

| 메서드 | 경로 | 설명 |
|--------|------|------|
| GET/POST | `/api/ai/subtitles` | 자막 목록/생성 |
| GET/PATCH/DELETE | `/api/ai/subtitles/[id]` | 자막 상세/수정/삭제 |
| GET/POST | `/api/ai/subtitles/[id]/segments` | 세그먼트 목록/추가 |
| PATCH/DELETE | `/api/ai/subtitles/[id]/segments/[segmentId]` | 세그먼트 수정/삭제 |

### 4.3 라이브러리

- `src/lib/ai/whisper.ts` - Whisper API 연동

---

## 5. 실시간 협업 (Collaboration)

### 5.1 컴포넌트

- `CollaborativeBoardCanvas` - 실시간 협업 보드 캔버스
- `CollaboratorAvatars` - 협업자 아바타 표시
- `CollaboratorCursor` - 협업자 커서 표시

### 5.2 Hook

- `use-collaboration.ts` - 협업 상태 관리

### 5.3 라이브러리

- `src/lib/collaboration/SupabaseProvider.ts` - Supabase Realtime 연동

### 5.4 관련 컴포넌트 수정

- `BoardDetailClient.tsx` - 보드 상세 클라이언트 컴포넌트 분리

---

## 6. Google Drive 통합 (Integrations)

### 6.1 페이지

- `/settings/integrations` - 통합 설정 페이지

### 6.2 컴포넌트

- `GoogleDriveCard` - Google Drive 연결 카드
- `GoogleDriveFileBrowser` - 파일 브라우저

### 6.3 API 엔드포인트

| 메서드 | 경로 | 설명 |
|--------|------|------|
| GET | `/api/integrations/google-drive` | 연결 상태 |
| GET | `/api/integrations/google-drive/auth` | OAuth 인증 시작 |
| GET | `/api/integrations/google-drive/callback` | OAuth 콜백 |
| GET | `/api/integrations/google-drive/status` | 연결 상태 확인 |
| GET | `/api/integrations/google-drive/files` | 파일 목록 |
| POST | `/api/integrations/google-drive/import` | 파일 가져오기 |
| POST | `/api/integrations/google-drive/export` | 파일 내보내기 |

### 6.4 라이브러리

- `src/lib/integrations/google-drive.ts` - Google Drive API 클라이언트

---

## 7. AI 기능 (AI Features)

### 7.1 AI 챗봇

- `AIChatbot` - AI 챗봇 컴포넌트
- `AIChatbotPanel` - 챗봇 패널
- `src/lib/ai/chatbot-context.ts` - 챗봇 컨텍스트 관리
- `POST /api/ai/chatbot` - 챗봇 API

### 7.2 영상 변경점 분석

- `VideoDiffAnalyzer` - 영상 변경점 분석 컴포넌트
- `src/lib/ai/video-diff.ts` - 변경점 분석 로직
- `POST /api/ai/video-diff` - 변경점 분석 API

---

## 8. 다국어 지원 (i18n)

### 8.1 파일

- `messages/ko.json` - 한국어
- `messages/en.json` - 영어
- `messages/ja.json` - 일본어

### 8.2 설정

- `src/i18n/config.ts` - i18n 설정
- `src/i18n/request.ts` - 요청별 로케일

### 8.3 컴포넌트

- `LanguageSwitcher` - 언어 전환 컴포넌트

---

## 9. 설정 페이지 확장

### 9.1 새 설정 페이지

| 경로 | 설명 |
|------|------|
| `/settings/notifications` | 알림 설정 |
| `/settings/integrations` | 외부 서비스 연결 |
| `/settings/portfolio` | 포트폴리오 설정 |

---

## 10. 데이터베이스 마이그레이션

| 파일 | 설명 |
|------|------|
| `00026_portfolios.sql` | 포트폴리오 테이블 |
| `00027_push_subscriptions.sql` | 푸시 구독 테이블 |
| `00028_video_subtitles.sql` | 자막 테이블 |
| `00029_ai_change_detection.sql` | AI 변경점 감지 테이블 |
| `00030_external_integrations.sql` | 외부 통합 테이블 |
| `00031_ai_usage.sql` | AI 사용량 테이블 |
| `00032_edit_projects.sql` | 편집 프로젝트 테이블 |

---

## 11. 타입 정의

| 파일 | 설명 |
|------|------|
| `src/types/editing.ts` | 편집 관련 타입 |
| `src/types/portfolio.ts` | 포트폴리오 타입 |
| `src/types/pwa.ts` | PWA 타입 |
| `src/types/subtitle.ts` | 자막 타입 |
| `src/types/video-diff.ts` | 영상 변경점 타입 |
| `src/types/chatbot.ts` | 챗봇 타입 |

---

## 12. 버그 수정

### 12.1 HLS Manifest 파싱 에러

**문제:** 편집 워크스페이스 진입 시 "Manifest: Line: 1, column: 1, Syntax error"

**원인:** `videoUrl`이 null인 상태에서 HLS 플레이어 초기화

**해결:** `videoUrl` 존재 여부에 따라 VideoUploader/VideoPreview 조건부 렌더링

### 12.2 영상 피드백 페이지 자막 생성 제거

**문제:** 자막 생성이 피드백 페이지와 편집 워크스페이스에 중복

**해결:** 피드백 페이지에서 SubtitleGenerator 제거, 편집 워크스페이스에서만 제공

---

## 13. 규칙 업데이트

### ERROR_PREVENTION.md v2.8

**추가된 섹션:**
- §29.1: HLS Manifest 파싱 에러 방지
- §29.2: 편집 워크스페이스 영상 업로드 패턴
- §29.3: 기능 위치 원칙 (피드백 vs 편집)
- §29.4: Zod .transform() 패턴
- §30: 편집 워크스페이스 체크리스트
- §31: 관련 파일 목록

---

## 14. 파일 변경 통계

```
총 변경 파일: 121개
새로 추가된 파일: 103개
수정된 파일: 18개
총 변경 라인: +26,713 / -1,009
```

### 새로 추가된 디렉토리

| 디렉토리 | 설명 |
|----------|------|
| `src/app/(dashboard)/projects/[id]/edits/` | 편집 페이지 |
| `src/app/(dashboard)/settings/integrations/` | 통합 설정 |
| `src/app/(dashboard)/settings/notifications/` | 알림 설정 |
| `src/app/(dashboard)/settings/portfolio/` | 포트폴리오 설정 |
| `src/app/api/ai/` | AI API |
| `src/app/api/integrations/` | 통합 API |
| `src/app/api/portfolio/` | 포트폴리오 API |
| `src/app/api/push/` | 푸시 API |
| `src/app/p/` | 공개 포트폴리오 |
| `src/components/collaboration/` | 협업 컴포넌트 |
| `src/components/editing/` | 편집 컴포넌트 |
| `src/components/integrations/` | 통합 컴포넌트 |
| `src/components/portfolio/` | 포트폴리오 컴포넌트 |
| `src/components/pwa/` | PWA 컴포넌트 |
| `src/components/video/subtitles/` | 자막 컴포넌트 |
| `src/i18n/` | 다국어 설정 |
| `src/lib/collaboration/` | 협업 라이브러리 |
| `src/lib/integrations/` | 통합 라이브러리 |
| `src/lib/push/` | 푸시 라이브러리 |
| `messages/` | 다국어 메시지 |

---

## 15. 다음 작업 예정

1. 마이그레이션 Supabase 적용
2. PWA 서비스 워커 구현
3. Google Drive OAuth 설정
4. AI API 키 연동 (OpenAI, Whisper)
5. 푸시 알림 VAPID 키 설정
6. 자막 편집 UI 개선
7. 협업 기능 테스트

---

## 16. 참고 사항

- AI 기능은 API 키 설정 필요 (OpenAI)
- Google Drive는 OAuth 클라이언트 설정 필요
- 푸시 알림은 VAPID 키 설정 필요
- 마이그레이션은 순서대로 적용 필요 (00026 ~ 00032)

---

**작성자:** Claude Code
**커밋:** 10.전체 기능 통합: 편집 워크스페이스 + PWA + 포트폴리오 + 자막 + 협업 + 통합
