# 개발 노트 - 2026-01-28

## 버전: 06. 보드 캔버스 + 영상 비교 모달 개선 + Sprint 11-12 Quick Wins

**이전 버전:** 05.채팅 읽음 숫자 표시 + Phase 2-3 스프린트 문서

---

## 주요 변경사항

### 1. 보드 캔버스 시스템 (신규)

#### 기능
- **무한 캔버스**: 줌인/줌아웃, 패닝 지원
- **다양한 요소 지원**:
  - 텍스트 (더블클릭 편집)
  - 스티키 노트 (6가지 색상)
  - 이미지 (원본 크기 유지, 최대 800px)
  - 영상 (썸네일 자동 추출, 재생 버튼 표시)
  - 도형 (사각형, 원, 삼각형, 화살표, 별, 선)
  - 프레임 (그룹화용)
- **레이어 패널**: 요소 순서 변경, 표시/숨김, 잠금
- **속성 패널**: 색상, 테두리, 폰트 등 스타일 편집
- **자동 저장**: 2초 디바운스로 변경사항 자동 저장
- **히스토리**: Undo/Redo 지원
- **내보내기**: PNG, JPEG, PDF 형식

#### 파일
- `src/components/board/` - 보드 컴포넌트 전체
- `src/stores/board-store.ts` - Zustand 상태 관리
- `src/types/board.ts` - 타입 정의
- `src/app/api/boards/` - API 라우트
- `supabase/migrations/00017_boards.sql` - DB 스키마

### 2. 영상 비교 모달 개선

#### 변경 전
- 컨트롤바가 하단에 고정
- 플레이 버튼 보이지 않음

#### 변경 후
- **중앙 플레이 버튼**: 일시정지 상태에서 영상 중앙에 큰 플레이 버튼 표시
- **오버레이 컨트롤바**: 영상 위에 그라데이션 배경으로 오버레이
- **호버 컨트롤**:
  - 마우스 이동 시 컨트롤 표시
  - 재생 중 3초 후 자동 숨김
  - 일시정지 상태에서는 항상 표시
- 일반 영상 플레이어(VideoPlayer.tsx)와 동일한 UX

#### 파일
- `src/components/video/VideoCompareModal.tsx`

### 3. 피드백 템플릿 시스템 (Sprint 11 - Task 1)

- 자주 쓰는 피드백 문구 템플릿 저장
- 드래그앤드롭으로 순서 변경
- 최대 20개 제한

#### 파일
- `src/components/video/FeedbackTemplateSelect.tsx`
- `src/components/video/FeedbackTemplateManager.tsx`
- `src/app/api/feedback-templates/`
- `supabase/migrations/00014_feedback_templates.sql`

### 4. 빠른 승인 버튼 (Sprint 11 - Task 2)

- 영상 버전 승인 기능
- 승인 시 알림 발송
- 승인 상태 표시

#### 파일
- `src/components/video/ApprovalButton.tsx`
- `src/app/api/videos/[id]/approve/`
- `supabase/migrations/00015_video_approval.sql`

### 5. 키보드 단축키 시스템 (Sprint 11 - Task 3)

#### 전역 단축키
- `Cmd/Ctrl + K`: 글로벌 검색 (Command Palette)
- `Cmd/Ctrl + /`: 단축키 도움말

#### 영상 페이지 단축키
- `Space`: 재생/정지
- `←/→`: 5초 이동
- `J/K`: 다음/이전 피드백

#### 파일
- `src/hooks/use-global-hotkeys.ts`
- `src/components/common/ShortcutsHelpModal.tsx`
- `src/components/common/CommandPalette.tsx`
- `src/components/providers/GlobalHotkeysProvider.tsx`

### 6. QR 코드 공유 (Sprint 11 - Task 4)

- 프로젝트 공유 QR 코드 생성
- PNG 다운로드 지원
- 링크 복사 기능

#### 파일
- `src/components/project/QRCodeModal.tsx`
- `src/components/project/ProjectShareDropdown.tsx`

### 7. 피드백 통계 대시보드 (Sprint 11 - Task 5)

- 피드백 현황 요약 카드
- 상태별 파이 차트
- 추이 라인 차트

#### 파일
- `src/components/project/FeedbackStatsCards.tsx`
- `src/components/project/FeedbackStatusPieChart.tsx`
- `src/components/project/FeedbackTrendChart.tsx`
- `src/components/project/ProjectFeedbackStats.tsx`
- `src/app/api/projects/[id]/feedback-stats/`

### 8. UX 개선 (Sprint 12 - Task 6)

- 토스트 최대 3개 스택, 5초 후 자동 제거
- 버튼 loading prop 추가 (스피너 표시)
- 통일된 빈 상태 UI 컴포넌트
- 에러 메시지 매핑

#### 파일
- `src/hooks/use-toast.ts`
- `src/components/ui/toaster.tsx`
- `src/components/ui/button.tsx`
- `src/components/common/EmptyState.tsx`
- `src/lib/error-messages.ts`

### 9. 변경 마커 시스템

- 영상 버전 간 변경 구간 표시
- 시작/종료 시간 마킹
- 타임라인에 마커 시각화

#### 파일
- `src/components/video/markers/`
- `src/app/api/videos/[id]/versions/[versionId]/markers/`
- `src/types/change-marker.ts`
- `supabase/migrations/00018_change_markers.sql`

---

## 버그 수정

### 보드 관련
1. **React key prop 에러**: `commonProps` 객체에서 key를 분리하여 직접 전달
2. **이미지 크기 압축**: 원본 크기 유지하도록 `getImageDimensions()` 함수 추가
3. **영상 첨부 오류**: `ImageElement`에서 video 타입 처리 추가
4. **자동저장 미작동**: 2초 디바운스 자동저장 기능 구현
5. **텍스트 입력 버벅임**: 모든 요소 컴포넌트에 `memo`, `useCallback` 적용

### 영상 비교 모달
1. **플레이 버튼 미표시**: 중앙 플레이 버튼 오버레이 추가
2. **컨트롤바 항상 표시**: 호버 시 표시/자동 숨김 패턴 적용

---

## 추가된 패키지

```json
{
  "@dnd-kit/core": "^6.x",
  "@dnd-kit/sortable": "^8.x",
  "@dnd-kit/utilities": "^3.x",
  "react-hotkeys-hook": "^4.x",
  "qrcode": "^1.x",
  "@types/qrcode": "^1.x",
  "react-konva": "^18.x",
  "konva": "^9.x"
}
```

---

## DB 마이그레이션

| 파일 | 설명 |
|------|------|
| `00014_feedback_templates.sql` | 피드백 템플릿 (profiles.feedback_templates JSONB) |
| `00015_video_approval.sql` | 영상 승인 (video_versions.approved_at, approved_by) |
| `00016_approver_role.sql` | 승인자 역할 |
| `00017_boards.sql` | 보드 테이블 (boards, board_elements) |
| `00018_change_markers.sql` | 변경 마커 테이블 |

---

## 파일 변경 요약

- **신규 파일**: 약 50개
- **수정 파일**: 31개
- **마이그레이션**: 5개

---

## 다음 작업 예정

- 보드 실시간 협업 (Supabase Realtime)
- 보드 템플릿
- 영상 내 드로잉 피드백
